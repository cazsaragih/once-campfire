<% cache membership do %>
  <% members = membership.room.users.without(membership.user).presence || [ membership.user ] %>

  <%= link_to_room membership.room, class: [ "direct", "unread": membership.unread? ], id: dom_id(membership.room, :list),
        data: { sorted_list_number: membership.room.updated_at.to_fs(:epoch) } do %>
    <% if members.many? %>
      <div class="avatar__group">
        <% members.first(4).each do |member| %>
          <span class="avatar">
            <%= image_tag fresh_user_avatar_path(member), size: 20, aria: { hidden: "true" } %>
          </span>
        <% end %>
      </div>
    <% else %>
      <span class="avatar avatar--sm avatar--<%= members.first.availability %>">
        <%= image_tag fresh_user_avatar_path(members.first), size: 20, aria: { hidden: "true" } %>
      </span>
    <% end %>

    <span class="direct__author">
      <span class="for-screen-reader">Ping with</span>
      <% if members.many? %>
        <%= members.map { |member| member.name.split(' ')[0] }.to_sentence %>
      <% else %>
        <%= members.first.name.split(' ')[0] %>
      <% end %>
    </span>
  <% end %>
<% end %>
